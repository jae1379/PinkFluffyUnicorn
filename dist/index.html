<html>
  <head>
    <title>Pink Fluffy Unicorn Game Engine</title>
    <link href="https://fonts.googleapis.com/css?family=Bubblegum+Sans" rel="stylesheet">
    <link rel='stylesheet' href='unicorn.css' />
    <script src="pinkfluffyunicorn.min.js"></script>
  </head>
  <body>
    <div id="unicorn-display"></div>
    <audio id="audio" controls="" style="visibility: hidden;">
      <source id="source" type="audio/wav">
    </audio>
    <script>
      var counter = 0;
      function getRandomInt( number ) {
        return Math.floor( number * Math.random() );
      }

      function launchTacos() {
        counter++;
        switch( Math.floor( 8 * Math.random() ) ) {
          case 0:
            Unicorn.AddParticles( "Confetti" + counter, {
              blendMode: PIXI.BLEND_MODES.NORMAL,
              shape: "line", // "cone", "line"
              // lineDirection: 0,
              // length: 400,
              startColor: "#ffffff",
              endColor: "#ffffff",
              angle: Math.PI / 2 + Math.PI / 10,
              intensity: 0.75, // Scale from 1 - 10
              minSpeed: 0.25,
              maxSpeed: 0.5,
              decay: 10, // Scale from 0 - 10
              image: "assets/tacoParticle.png",
            }, 0, -50);
            break;
          case 1:
            Unicorn.AddParticles( "Confetti" + counter, {
              blendMode: PIXI.BLEND_MODES.NORMAL,
              shape: "line", // "cone", "line"
              // lineDirection: 0,
              // length: 400,
              startColor: "#ffffff",
              endColor: "#ffffff",
              angle: Math.PI / 2 - Math.PI / 10,
              intensity: 0.75, // Scale from 1 - 10
              minSpeed: 0.25,
              maxSpeed: 0.5,
              decay: 10, // Scale from 0 - 10
              image: "assets/tacoParticle.png",
            }, 0, -70);
            break;
          case 2:
            Unicorn.AddParticles( "Confetti" + counter, {
              blendMode: PIXI.BLEND_MODES.NORMAL,
              shape: "line", // "cone", "line"
              // lineDirection: 0,
              // length: 400,
              startColor: "#ffffff",
              endColor: "#ffffff",
              angle: Math.PI / 2 + Math.PI / 5,
              intensity: 0.75, // Scale from 1 - 10
              minSpeed: 0.25,
              maxSpeed: 0.5,
              decay: 10, // Scale from 0 - 10
              image: "assets/tacoParticle.png",
            }, 0, -59);
            break;
          case 3:
            Unicorn.AddParticles( "Confetti" + counter, {
              blendMode: PIXI.BLEND_MODES.NORMAL,
              shape: "line", // "cone", "line"
              // lineDirection: 0,
              // length: 400,
              startColor: "#ffffff",
              endColor: "#ffffff",
              angle: Math.PI / 2,
              intensity: 0.75, // Scale from 1 - 10
              minSpeed: 0.25,
              maxSpeed: 0.5,
              decay: 10, // Scale from 0 - 10
              image: "assets/tacoParticle.png",
            }, 0, -100);
            break;
          case 4:
            Unicorn.AddParticles( "Confetti" + counter, {
              blendMode: PIXI.BLEND_MODES.NORMAL,
              shape: "line", // "cone", "line"
              // lineDirection: 0,
              // length: 400,
              startColor: "#ffffff",
              endColor: "#ffffff",
              angle: Math.PI / 2 + Math.PI / 10,
              intensity: 0.75, // Scale from 1 - 10
              minSpeed: 0.25,
              maxSpeed: 0.5,
              decay: 10, // Scale from 0 - 10
              image: "assets/tacoParticle.png",
            }, 0, -50);
            break;
          case 5:
            Unicorn.AddParticles( "Confetti" + counter, {
              blendMode: PIXI.BLEND_MODES.NORMAL,
              shape: "line", // "cone", "line"
              // lineDirection: 0,
              // length: 400,
              startColor: "#ffffff",
              endColor: "#ffffff",
              angle: Math.PI / 2 - Math.PI / 10,
              intensity: 0.75, // Scale from 1 - 10
              minSpeed: 0.25,
              maxSpeed: 0.5,
              decay: 10, // Scale from 0 - 10
              image: "assets/tacoParticle.png",
            }, 0, -70);
            break;
          case 6:
            Unicorn.AddParticles( "Confetti" + counter, {
              blendMode: PIXI.BLEND_MODES.NORMAL,
              shape: "line", // "cone", "line"
              // lineDirection: 0,
              // length: 400,
              startColor: "#ffffff",
              endColor: "#ffffff",
              angle: Math.PI / 2 + Math.PI / 5,
              intensity: 0.75, // Scale from 1 - 10
              minSpeed: 0.25,
              maxSpeed: 0.5,
              decay: 10, // Scale from 0 - 10
              image: "assets/tacoParticle.png",
            }, 0, -59);
            break;
          case 7:
            Unicorn.AddParticles( "Confetti" + counter, {
              blendMode: PIXI.BLEND_MODES.NORMAL,
              shape: "line", // "cone", "line"
              // lineDirection: 0,
              // length: 400,
              startColor: "#ffffff",
              endColor: "#ffffff",
              angle: Math.PI / 2,
              intensity: 0.75, // Scale from 1 - 10
              minSpeed: 0.25,
              maxSpeed: 0.5,
              decay: 10, // Scale from 0 - 10
              image: "assets/tacoParticle.png",
            }, 0, -100);
            break;
        }
        stopParticles( "Confetti" + counter, 2000 );
      }

      function launchConfetti( imageOverride = "" ) {
        counter++;
        switch( Math.floor( 8 * Math.random() ) ) {
          case 0:
            Unicorn.AddParticles( "Confetti" + counter, {
              blendMode: PIXI.BLEND_MODES.DEFAULT,
              shape: "line", // "cone", "line"
              // lineDirection: 0,
              // length: 400,
              angle: Math.PI / 2 + Math.PI / 10,
              startColor: "#ff0000",
              endColor: "#FB8200",
              intensity: 0.75, // Scale from 1 - 10
              minSpeed: 0.05,
              maxSpeed: 0.5,
              decay: 10, // Scale from 0 - 10
              image: imageOverride || "assets/confetti.png",
            }, 0, -50);
            break;
          case 1:
            Unicorn.AddParticles( "Confetti" + counter, {
              blendMode: PIXI.BLEND_MODES.DEFAULT,
              shape: "line", // "cone", "line"
              // lineDirection: 0,
              // length: 400,
              angle: Math.PI / 2 - Math.PI / 10,
              startColor: "#00ff00",
              endColor: "#FB8200",
              intensity: 0.75, // Scale from 1 - 10
              minSpeed: 0.05,
              maxSpeed: 0.5,
              decay: 10, // Scale from 0 - 10
              image: imageOverride || "assets/confetti4.png",
            }, 0, -70);
            break;
          case 2:
            Unicorn.AddParticles( "Confetti" + counter, {
              blendMode: PIXI.BLEND_MODES.DEFAULT,
              shape: "line", // "cone", "line"
              // lineDirection: 0,
              // length: 400,
              angle: Math.PI / 2 + Math.PI / 5,
              startColor: "#ffff00",
              endColor: "#FB8200",
              intensity: 0.75, // Scale from 1 - 10
              minSpeed: 0.05,
              maxSpeed: 0.5,
              decay: 10, // Scale from 0 - 10
              image: imageOverride || "assets/confetti3.png",
            }, 0, -59);
            break;
          case 3:
            Unicorn.AddParticles( "Confetti" + counter, {
              blendMode: PIXI.BLEND_MODES.DEFAULT,
              shape: "line", // "cone", "line"
              // lineDirection: 0,
              // length: 400,
              angle: Math.PI / 2,
              startColor: "#0000ff",
              endColor: "#FB8200",
              intensity: 0.75, // Scale from 1 - 10
              minSpeed: 0.05,
              maxSpeed: 0.5,
              decay: 10, // Scale from 0 - 10
              image: imageOverride || "assets/confetti2.png",
            }, 0, -100);
            break;
          case 4:
            Unicorn.AddParticles( "Confetti" + counter, {
              blendMode: PIXI.BLEND_MODES.DEFAULT,
              shape: "line", // "cone", "line"
              // lineDirection: 0,
              // length: 400,
              angle: Math.PI / 2 + Math.PI / 10,
              startColor: "#ff0000",
              endColor: "#FB8200",
              intensity: 0.75, // Scale from 1 - 10
              minSpeed: 0.05,
              maxSpeed: 0.5,
              decay: 10, // Scale from 0 - 10
              image: imageOverride || "assets/confetti4.png",
            }, 0, -50);
            break;
          case 5:
            Unicorn.AddParticles( "Confetti" + counter, {
              blendMode: PIXI.BLEND_MODES.DEFAULT,
              shape: "line", // "cone", "line"
              // lineDirection: 0,
              // length: 400,
              angle: Math.PI / 2 - Math.PI / 10,
              startColor: "#00ff00",
              endColor: "#FB8200",
              intensity: 0.75, // Scale from 1 - 10
              minSpeed: 0.05,
              maxSpeed: 0.5,
              decay: 10, // Scale from 0 - 10
              image: imageOverride || "assets/confetti1.png",
            }, 0, -70);
            break;
          case 6:
            Unicorn.AddParticles( "Confetti" + counter, {
              blendMode: PIXI.BLEND_MODES.DEFAULT,
              shape: "line", // "cone", "line"
              // lineDirection: 0,
              // length: 400,
              angle: Math.PI / 2 + Math.PI / 5,
              startColor: "#ffff00",
              endColor: "#FB8200",
              intensity: 0.75, // Scale from 1 - 10
              minSpeed: 0.05,
              maxSpeed: 0.5,
              decay: 10, // Scale from 0 - 10
              image: imageOverride || "assets/confetti.png",
            }, 0, -59);
            break;
          case 7:
            Unicorn.AddParticles( "Confetti" + counter, {
              blendMode: PIXI.BLEND_MODES.DEFAULT,
              shape: "line", // "cone", "line"
              // lineDirection: 0,
              // length: 400,
              angle: Math.PI / 2,
              startColor: "#0000ff",
              endColor: "#FB8200",
              intensity: 0.75, // Scale from 1 - 10
              minSpeed: 0.05,
              maxSpeed: 0.5,
              decay: 10, // Scale from 0 - 10
              image: imageOverride || "assets/confetti3.png",
            }, 0, -100);
            break;
        }
        stopParticles( "Confetti" + counter, 2000 );
      }

      function stopParticles( name, time = 2000 ) {
        setTimeout( () => {
          Unicorn.RemoveParticles( name );
        }, time );
      }

      function launchExplosion( count, imageOverride = "" ) {
        counter++;
        let explosionScale = Math.min( Math.max( 1, count ), 100 );
        let spawnX = getRandomInt( 1280 );
        let spawnY = getRandomInt( 720 );
        Unicorn.AddParticles( "Explosion" + counter, {
          blendMode: PIXI.BLEND_MODES.DEFAULT,
          shape: "circle",
          // lineDirection: 0,
          // length: 400,
          startColor: "#ff0000",
          endColor: "#FB8200",
          intensity: 200 * explosionScale * explosionScale, // Scale from 1 - 10
          minSpeed: 0.0,
          maxSpeed: 0.15 + explosionScale / 200,
          gravityX: 0,
          gravityY: 5,//3.5,
          fadeOut: true,
          decay: 1, // Scale from 0 - 10
          image: imageOverride || undefined
        }, spawnX, spawnY );
        Unicorn.AddParticles( "Smoke" + counter, {
          blendMode: PIXI.BLEND_MODES.SCREEN,
          shape: "circle",
          // lineDirection: 0,
          // length: 400,
          startColor: "#000000",
          endColor: "#999999",
          intensity: 20 * explosionScale, // Scale from 1 - 10
          minSpeed: 0.0,
          maxSpeed: 0.1,
          gravityX: 0,
          gravityY: -1,
          growOverTime: true,
          fadeOut: true,
          decay: 1, // Scale from 0 - 10
          image: imageOverride || undefined
        }, spawnX, spawnY );
        stopParticles( "Explosion" + counter, 250 );
        stopParticles( "Smoke" + counter, 500 );
      }

      function launchFirework( imageOverride = "" ) {
        counter++;
        let id = counter;
        let spawnX = getRandomInt( 1280 );
        let spawnY = 720 + getRandomInt( 400 );
        Unicorn.AddParticles( "FireworkTrail" + id, {
          blendMode: PIXI.BLEND_MODES.COLOR,
          shape: "circle",
          startColor: "#6E9887",
          endColor: "#E06C9F",
          intensity: 100, // Scale from 1 - 10
          minSpeed: 0.0,
          maxSpeed: 0.01,
          gravityX: 0,
          gravityY: 10,//3.5,
          flySpeed: 0.75,
          fadeOut: true,
          decay: 0.5, // Scale from 0 - 10
          image: imageOverride || "assets/kaboomtrail.png"
        }, spawnX, spawnY );
        setTimeout( () => {
          Unicorn.PlaySound( "firework", {
            volume: 0.1
          } );
          let explosionY = spawnY - 0.75 * 1000;
          Unicorn.AddParticles( "Fireworks" + id, {
            blendMode: PIXI.BLEND_MODES.LIGHTEN,
            shape: "circle",
            startColor: "#D7F9FF",
            endColor: "#F283B6",
            intensity: 200, // Scale from 1 - 10
            minSpeed: 0.2,
            maxSpeed: 0.5,
            gravityX: 0,
            gravityY: 3.5,
            fadeOut: true,
            decay: 2, // Scale from 0 - 10
            image: imageOverride || "assets/kaboomtrail.png"
          }, spawnX, explosionY );
        }, 1000 );
        // Unicorn.AddParticles( "Smoke" + counter, {
        //   blendMode: PIXI.BLEND_MODES.SCREEN,
        //   shape: "circle",
        //   // lineDirection: 0,
        //   // length: 400,
        //   startColor: "#000000",
        //   endColor: "#999999",
        //   intensity: 20 * explosionScale, // Scale from 1 - 10
        //   minSpeed: 0.0,
        //   maxSpeed: 0.1,
        //   gravityX: 0,
        //   gravityY: -1,
        //   growOverTime: true,
        //   fadeOut: true,
        //   decay: 1, // Scale from 0 - 10
        //   image: imageOverride || undefined
        // }, spawnX, spawnY );
        stopParticles( "FireworkTrail" + id, 1000 );
        stopParticles( "Fireworks" + id, 1150 );
      }

      function Init() {
        // Add Initialization Here
        // Unicorn.Load( "fart", "assets/fart-2.wav" );
        // Unicorn.Load( "yay", "assets/yay.mp3" );
        // Unicorn.Load( "explode1", "assets/explode1.mp3" );
        // Unicorn.Load( "explode2", "assets/explode2.mp3" );
        // Unicorn.Load( "firework", "assets/firework.mp3" );
        // Unicorn.Load( "unicorn", "assets/Unicorn.png" );
        // Unicorn.Load( "ball", "assets/Ball.png" );
        Unicorn.Load({
          "fart": "assets/fart-2.wav",
          "yay": "assets/yay.mp3",
          "explode1": "assets/explode1.mp3",
          "explode2": "assets/explode2.mp3",
          "firework": "assets/firework.mp3",
          "unicorn": "assets/Unicorn.png",
          "ball": "assets/Ball.png",
        });

        // Unicorn.AddObject( {
        //   "ball1": {
        //     type: "circle",
        //     x: 64, y: 64,
        //     radius: 64,
        //     sprite: "ball",
        //     friction: 0.01,
        //     onHover: function() {
        //       this.alpha = 0.5;
        //     },
        //     onLeave: function() {
        //       this.alpha = 1;
        //     }
        //   },
        //   "ball2": {
        //     type: "circle",
        //     x: 256, y: 64,
        //     radius: 64,
        //     // sprite: "ball",
        //     friction: 0.02
        //   }
        // });

        // Unicorn.Load( "hamster", "assets/rainbowHammie.png" );
        // Unicorn.AddOverlay( "icon", "unicorn", 100, 100 );
        // Unicorn.AddOverlay( "icon2", "ball", 150, 100, { z: 100 } );
        // Unicorn.AddOverlay( "icon3", "unicorn", 200, 100 );
        // Unicorn.AddText( "title", "Pink Fluffy Unicorn Game Engine", 50, 50, {
        //   fontFamily: 'Bubblegum Sans',
        //   fontSize: 36,
        //   fontWeight: 'bold',
        //   fill: "#ffffff"
        // });
        // Unicorn.AddObject( "box", {
        //   type: "rectangle",
        //   x: 64, y: 300,
        //   width: 128, height: 128,
        //   // sprite: "unicorn",
        //   // bounce: 3,
        //   isStatic: true
        // } );
        // Unicorn.AddDetector( "detect", {
        //   type: "rectangle",
        //   x: 64, y: 300,
        //   width: 128, height: 128
        // }, ( label, body ) => {
        //   console.log( "Enter:", label, body );
        //   Unicorn.PlaySound( "fart", {
        //     volume: 0.25
        //   } );
        // }, ( label, body ) => {
        //   console.log( "Exit:", label, body );
        // } );
        // Unicorn.AddObject( "ball1", {
        //   type: "circle",
        //   x: 64, y: 64,
        //   radius: 64,
        //   sprite: "ball",
        //   friction: 0.01,
        //   onHover: function() {
        //     this.alpha = 0.5;
        //   },
        //   onLeave: function() {
        //     this.alpha = 1;
        //   }
        // } );
        // Unicorn.AddObject( "ball2", {
        //   type: "circle",
        //   x: 256, y: 64,
        //   radius: 64,
        //   // sprite: "ball",
        //   friction: 0.02
        // } );
        // Unicorn.ConnectObjects( "ball1", "ball2", {
        //   length: 192,
        //   damping: 0.5,
        //   stiffness: 0.2
        // } );
        // Unicorn.ConnectObjects( "", "ball2", {
        //   damping: 0.5,
        //   stiffness: 0.2
        // }, { x: 300, y: 0 } );
        // Unicorn.AddParticles( "WIND", {
        //   blendMode: PIXI.BLEND_MODES.MULTIPLY,
        //   shape: "line", // "cone", "line"
        //   lineDirection: Math.PI / 2,
        //   // length: 400,
        //   angle: 0,
        //   startColor: "#333333",
        //   endColor: "#000000",
        //   intensity: 20, // Scale from 1 - 10
        //   minSpeed: 0.1,
        //   maxSpeed: 2.25,
        //   decay: 0.5, // Scale from 0 - 10
        // }, -100, 0);

        // Unicorn.AddParticles( "windysnow", {
        //   blendMode: PIXI.BLEND_MODES.DEFAULT,
        //   shape: "line", // "cone", "line"
        //   // lineDirection: 0,
        //   length: 1920,
        //   angle: Math.PI / 4,
        //   // startColor: "#88ff00",
        //   // endColor: "#ff0088",
        //   startColor: "#ffffff",
        //   endColor: "#ffffff",
        //   intensity: 5, // Scale from 1 - 10
        //   minSpeed: 0.1,
        //   maxSpeed: 1.25,
        //   decay: 5, // Scale from 0 - 10
        // }, -640, 0);
        // Unicorn.AddParticles( "ROOFISONFIRE", {
        //   blendMode: PIXI.BLEND_MODES.DEFAULT,
        //   shape: "line", // "cone", "line"
        //   // lineDirection: 0,
        //   // length: 400,
        //   angle: Math.PI / 2,
        //   startColor: "#ff0000",
        //   endColor: "#FB8200",
        //   intensity: 10000, // Scale from 1 - 10
        //   minSpeed: 0.1,
        //   maxSpeed: 0.25,
        //   decay: 2, // Scale from 0 - 10
        // }, 0, 0);
        // Unicorn.AddParticles( "FIRE", {
        //   blendMode: PIXI.BLEND_MODES.DEFAULT,
        //   shape: "line", // "cone", "line"
        //   // lineDirection: 0,
        //   // length: 400,
        //   angle: -Math.PI / 2,
        //   startColor: "#ff0000",
        //   endColor: "#FB8200",
        //   intensity: 10000, // Scale from 1 - 10
        //   minSpeed: 0.1,
        //   maxSpeed: 0.25,
        //   decay: 2, // Scale from 0 - 10
        // }, 0, 720);
        // Unicorn.AddParticles( "snow", {
        //   blendMode: PIXI.BLEND_MODES.DEFAULT,
        //   shape: "line", // "cone", "line"
        //   // lineDirection: 0,
        //   // length: 400,
        //   angle: Math.PI / 2,
        //   // startColor: "#88ff00",
        //   // endColor: "#ff0088",
        //   startColor: "#ffffff",
        //   endColor: "#ffffff",
        //   intensity: 4, // Scale from 1 - 10
        //   minSpeed: 0.1,
        //   maxSpeed: 1.25,
        //   decay: 5, // Scale from 0 - 10
        // }, 0, 0);
        // Unicorn.AddParticles( "rain", {
        //   blendMode: PIXI.BLEND_MODES.OVERLAY,
        //   shape: "line", // "cone", "line"
        //   // lineDirection: 0,
        //   // length: 400,
        //   image: "assets/rainbowHammie.png",
        //   angle: Math.PI / 2,
        //   // startColor: "#88ff00",
        //   // endColor: "#ff0088",
        //   startColor: "#ffffff",
        //   endColor: "#ffffff",
        //   intensity: 1, // Scale from 1 - 10
        //   minSpeed: 0.1,
        //   maxSpeed: 0.25,
        //   decay: 10, // Scale from 0 - 10
        // }, 0, 0);
        // Unicorn.AddParticles( "blastoff", {
        //   shape: "cone", // "cone", "line"
        //   angle: Math.PI / 2,
        //   spread: Math.PI / 2,
        //   // startColor: "#88ff00",
        //   endColor: "#ff0088",
        //   startColor: "#FB8200",
        //   // endColor: "#FEBE79",
        //   intensity: 50, // Scale from 1 - 10
        //   minSpeed: 0.1,
        //   maxSpeed: 0.25,
        //   decay: 1, // Scale from 0 - 10
        // }, 600, 100);
        // Unicorn.AddParticles( "fireworks", {
        //   shape: "circle", // "cone", "line"
        //   // startColor: "#88ff00",
        //   // endColor: "#ff0088",
        //   startColor: "#FB8200",
        //   endColor: "#FEBE79",
        //   intensity: 10, // Scale from 1 - 10
        //   minSpeed: 0.1,
        //   maxSpeed: 0.25,
        //   decay: 1, // Scale from 0 - 10
        // }, 100, 100);
        // Unicorn.AddTimer( "boom", 5000, () => {
        //   Unicorn.SetVelocity( "ball1", 50, -10 );
        //   Unicorn.ResetTimer( "boom", 2000 );
        // } )
      }

      function Update( timestamp, timeDiffInMs ) {
        // Add Update Loop
        // console.log( timestamp, timeDiffInMs );
        if( timestamp > 5000 ) {
          Unicorn.RemoveOverlay( "icon" );
        }
      }

      function OnChatCommand( user, command, message, flags, extra ) {
        // Handle Chat Commands
        if( flags.broadcaster && command == "test" ) {
          console.log( "!test was typed in chat" );
        }
        if( flags.broadcaster && command == "disconnect" ) {
          Unicorn.DisconnectObjects( "", "ball2" );
        }
        if( extra.customRewardId === "aa293422-d373-4357-ab9c-59689642b83a" ) {
          let fireworksScale = Math.max( 100, parseInt( message ) || 1 );
          Unicorn.PlaySound( "explode1", {
            volume: 0.1 + 0.1 * fireworksScale / 100
          } );
          launchExplosion( fireworksScale );
        }
        if( extra.customRewardId === "05e6c40d-2801-4368-bc7f-b6f7a188813a" ) {
          speakMessage( message );
          setTimeout( () => {
            for( var i = 0; i < 50; i++ ) {
              setTimeout( () => {
                let fireworksScale = getRandomInt( 100 );
                Unicorn.PlaySound( "explode1", {
                  volume: 0.1 + 0.1 * fireworksScale / 100
                } );
                launchExplosion( fireworksScale );
              }, Math.random() * 1000 );
            }
          }, 1000 );
        }
        // SUPEREXPLOSION
        if( extra.customRewardId === "af8d8368-7244-45b4-b624-077808d74afd" ) {
          speakMessage( message );
          setTimeout( () => {
            for( var i = 0; i < 1000; i++ ) {
              setTimeout( () => {
                let fireworksScale = getRandomInt( 100 );
                if( getRandomInt( 4 ) === 0 ) {
                  Unicorn.PlaySound( "explode1", {
                    volume: 0.1 + 0.1 * fireworksScale / 100
                  } );
                }
                launchExplosion( fireworksScale );
              }, Math.random() * 10000 );
            }
          }, 1000 );
        }
        // FIREWORKS!!!
        if( extra.customRewardId === "117e58b2-58fa-4fea-9cad-f800261a3271" ) {
          speakMessage( message );
          setTimeout( () => {
            for( var i = 0; i < 100; i++ ) {
              setTimeout( () => {
                launchFirework();
              }, Math.random() * 10000 );
            }
          }, 1000 );
        }
        if( extra.customRewardId === "70a77aa8-7e97-402f-b32b-a735a5ab031e" ) {
          for( var i = 0; i < 50; i++ ) {
            launchConfetti();
          }
          setTimeout( () => {
            Unicorn.PlaySound( "yay", {
              volume: 0.20
            } );
          }, 1000 );
        }
        if( command === "tacos" ) {
          for( var i = 0; i < 8; i++ ) {
            launchTacos();
          }
        }
        // if( command === "explode" ||
        //     command === "splode" ) {
        //   let fireworksScale = Math.max( 100, parseInt( message ) || 1 );
        //   // Unicorn.PlaySound( "explode1", {
        //   //   volume: 0.15 + 0.1 * fireworksScale / 100
        //   // } );
        //   launchExplosion( fireworksScale );
        // }
        // if( command === "superexplosion" ||
        //     command === "extremeplosion" ) {
        //   for( var i = 0; i < 50; i++ ) {
        //     setTimeout( () => {
        //       let fireworksScale = getRandomInt( 100 );
        //       // Unicorn.PlaySound( "explode1", {
        //       //   volume: 0.15 + 0.1 * fireworksScale / 100
        //       // } );
        //       launchExplosion( fireworksScale );
        //     }, Math.random() * 1000 );
        //   }
        // }
        if( command === "firework" ) {
          launchFirework();
        }
        if( command === "confetti" ||
            command === "party" ||
            command === "birthday" ||
            command === "celebrate" ||
            command === "yay" ) {
          for( var i = 0; i < 8; i++ ) {
            launchConfetti();
          }
          // setTimeout( () => {
          //   Unicorn.PlaySound( "yay", {
          //     volume: 0.25
          //   } );
          //   // stopParticles();
          // }, 1000 );
        }
      }

      function OnChatMessage( user, message, flags, self, extra ) {
        // Handle Chat Messages
        // console.log( extra.customRewardId );
        if( extra.customRewardId === "aa293422-d373-4357-ab9c-59689642b83a" ) {
          let fireworksScale = Math.max( 100, parseInt( message ) || 1 );
          Unicorn.PlaySound( "explode1", {
            volume: 0.1 + 0.1 * fireworksScale / 100
          } );
          launchExplosion( fireworksScale );
        }
        if( extra.customRewardId === "05e6c40d-2801-4368-bc7f-b6f7a188813a" ) {
          speakMessage( message );
          setTimeout( () => {
            for( var i = 0; i < 50; i++ ) {
              setTimeout( () => {
                let fireworksScale = getRandomInt( 100 );
                Unicorn.PlaySound( "explode1", {
                  volume: 0.1 + 0.1 * fireworksScale / 100
                } );
                launchExplosion( fireworksScale );
              }, Math.random() * 1000 );
            }
          }, 1000 );
        }
        // SUPEREXPLOSION
        if( extra.customRewardId === "af8d8368-7244-45b4-b624-077808d74afd" ) {
          speakMessage( message );
          setTimeout( () => {
            for( var i = 0; i < 1000; i++ ) {
              setTimeout( () => {
                let fireworksScale = getRandomInt( 100 );
                if( getRandomInt( 4 ) === 0 ) {
                  Unicorn.PlaySound( "explode1", {
                    volume: 0.1 + 0.1 * fireworksScale / 100
                  } );
                }
                launchExplosion( fireworksScale );
              }, Math.random() * 10000 );
            }
          }, 1000 );
        }
        // FIREWORKS!!!
        if( extra.customRewardId === "117e58b2-58fa-4fea-9cad-f800261a3271" ) {
          speakMessage( message );
          setTimeout( () => {
            for( var i = 0; i < 100; i++ ) {
              setTimeout( () => {
                launchFirework();
              }, Math.random() * 10000 );
            }
          }, 1000 );
        }
        if( extra.customRewardId === "70a77aa8-7e97-402f-b32b-a735a5ab031e" ) {
          for( var i = 0; i < 50; i++ ) {
            launchConfetti();
          }
          setTimeout( () => {
            Unicorn.PlaySound( "yay", {
              volume: 0.20
            } );
          }, 1000 );
        }
      }

      async function speakMessage( message, ttsVoice = "Amy" ) {
        let speak = await fetch( `https://api.streamelements.com/kappa/v2/speech?voice=${ttsVoice}&text=` + encodeURIComponent( message.trim() ) );
      	if( speak.status != 200 ) {
      		// await speak.text();
      		return;
      	}

        let mp3 = await speak.blob();
        let blobUrl = URL.createObjectURL( mp3 );
      	document.getElementById( "source" ).setAttribute( "src", blobUrl );
      	let audio = document.getElementById( "audio" );
      	audio.pause();
      	audio.load();
        audio.volume = 1;
      	audio.play();
      }

      window.addEventListener('load', () => {
        Unicorn.Create( "unicorn-display", {
          width: 1280,
          height: 720,
          // background: "#000000",// "transparent",
          background: "transparent",
          init: Init,
          update: Update,
          channel: "jae1379",
          onCommand: OnChatCommand,
          onChat: OnChatMessage,
          // screenWalls: false // Default: true
          // gravity: { x: 0, y: 0.5 } // Default: { x: 0, y: 1 }
        });
      });
    </script>
  </body>
</html>
